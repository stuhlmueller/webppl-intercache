---
title: "Polynomial Degree 3: Linear function"
author: "mht, jf, ast"
date: "April 21, 2016"
output: html_document
---

```{r echo=FALSE, message=F, warning=F}
library(dplyr)
library(tidyr)
library(ggplot2)
library(jsonlite)
library(data.table)

d<- fromJSON(readLines("linear-polynomial-3.json"))

df<-bind_rows(
  data.frame(
    param = "errorOverTime",
    iter = seq(1, length(d$errorOverTime)),
    val = d$errorOverTime
  ),
  data.frame(
    param = "hitRate",
    iter = seq(1, length(d$hitRate)),
    val = d$hitRate
  ),
  data.frame(
    param = "avgTime",
    iter = seq(1, length(d$avgTime)),
    val = d$avgTime
  ),
  data.frame(
    param = "avgSlowTime",
    iter = seq(1, length(d$avgSlowTime)),
    val = d$avgSlowTime
  ),
  data.frame(
    param = "avgCacheLookupTime",
    iter = seq(1, length(d$avgCacheLookupTime)),
    val = d$avgCacheLookupTime
  )
) %>%
  mutate(param = factor(param)) #same as mutate(df, param=factor(param))
```



```{r echo=FALSE, message=F, warning=F}
ggplot(df %>% filter(param%in%c('errorOverTime', 'hitRate')), 
       aes(x=iter,
           y=val))+
  geom_point()+
  geom_smooth()+
  xlab('"Iteration"')+
  facet_wrap(~param)

```

Left: The absolute error over time for cache hits only.
Right: The average hit rate over a window of 20 calls, starting with a particular call.

```{r echo=FALSE, message=F, warning=F}
ggplot(df %>% filter(param%in%c('avgTime')), 
       aes(x=iter,
           y=val))+
  geom_point()+
  geom_smooth()+
  xlab('"Iteration"')+
  ylab('Running Time per iteration')+
  geom_hline(data = df %>% 
               filter(param%in%c("avgCacheLookupTime", "avgSlowTime")),
             aes(yintercept = val, linetype = param))
```

Average query time over a window of 20 calls, compared to global average of non-cached query (avgSlowTime) and average time of cache hits (avgCacheLookupTime).

```{r echo=FALSE, message=F, warning=F}
dfObserved <- data.frame(inpt = d$observedInputs, 
                         outpt = d$observedOutputs)

dfPredicted <- data.frame(d$predictedOutputs) %>%
  dplyr::rename(inpt = X1, outpt = X2)
  
ggplot(data=dfObserved, mapping=aes(x=inpt, y=outpt)) +
  geom_point() +
  geom_point(data=dfPredicted, color="blue")
```

